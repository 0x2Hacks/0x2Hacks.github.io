{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nfunction sanitize(params, defaults) {\n  const result = Object.assign(Object.assign({}, defaults), params);\n\n  if (typeof result.retries === 'undefined') {\n    result.retries = defaults.retries;\n  }\n\n  if (typeof result.retryDelay === 'undefined') {\n    result.retryDelay = defaults.retryDelay;\n  }\n\n  if (typeof result.retryOn === 'undefined') {\n    result.retryOn = defaults.retryOn;\n  }\n\n  return result;\n} // eslint-disable-next-line @typescript-eslint/no-explicit-any\n\n\nfunction default_1(fetchFunc) {\n  let params = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  const defaults = sanitize(params, {\n    retries: 3,\n    retryDelay: 500,\n    retryOn: [419, 503, 504]\n  });\n  return function (input, init) {\n    const frp = sanitize({\n      retries: init === null || init === void 0 ? void 0 : init.retries,\n      retryDelay: init === null || init === void 0 ? void 0 : init.retryDelay,\n      retryOn: init === null || init === void 0 ? void 0 : init.retryOn\n    }, defaults);\n    const retryDelayFn = typeof frp.retryDelay === 'function' ? frp.retryDelay : () => frp.retryDelay;\n    const retryOnFn = typeof frp.retryOn === 'function' ? frp.retryOn : (attempt, retries, error, response) => (!!error || !response || frp.retryOn.indexOf(response.status) !== -1) && attempt < retries;\n    return new Promise(function (resolve, reject) {\n      const extendedFetch = function (attempt) {\n        fetchFunc(input, init).then(function (response) {\n          if (retryOnFn(attempt, frp.retries, null, response)) {\n            // eslint-disable-next-line @typescript-eslint/no-use-before-define\n            retry(attempt, null, response);\n          } else {\n            resolve(response);\n          }\n        }).catch(function (error) {\n          if (retryOnFn(attempt, frp.retries, error, null)) {\n            // eslint-disable-next-line @typescript-eslint/no-use-before-define\n            retry(attempt, error, null);\n          } else {\n            reject(error);\n          }\n        });\n      };\n\n      function retry(attempt, error, response) {\n        setTimeout(function () {\n          extendedFetch(++attempt);\n        }, retryDelayFn(attempt, error, response));\n      }\n\n      extendedFetch(0);\n    });\n  };\n}\n\nexports.default = default_1;","map":{"version":3,"sources":["../src/index.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nfunction sanitize(params, defaults) {\n    const result = Object.assign(Object.assign({}, defaults), params);\n    if (typeof result.retries === 'undefined') {\n        result.retries = defaults.retries;\n    }\n    if (typeof result.retryDelay === 'undefined') {\n        result.retryDelay = defaults.retryDelay;\n    }\n    if (typeof result.retryOn === 'undefined') {\n        result.retryOn = defaults.retryOn;\n    }\n    return result;\n}\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nfunction default_1(fetchFunc, params = {}) {\n    const defaults = sanitize(params, { retries: 3, retryDelay: 500, retryOn: [419, 503, 504] });\n    return function (input, init) {\n        const frp = sanitize({\n            retries: init === null || init === void 0 ? void 0 : init.retries,\n            retryDelay: init === null || init === void 0 ? void 0 : init.retryDelay,\n            retryOn: init === null || init === void 0 ? void 0 : init.retryOn,\n        }, defaults);\n        const retryDelayFn = typeof frp.retryDelay === 'function' ? frp.retryDelay : () => frp.retryDelay;\n        const retryOnFn = typeof frp.retryOn === 'function'\n            ? frp.retryOn\n            : (attempt, retries, error, response) => (!!error || !response || frp.retryOn.indexOf(response.status) !== -1) &&\n                attempt < retries;\n        return new Promise(function (resolve, reject) {\n            const extendedFetch = function (attempt) {\n                fetchFunc(input, init)\n                    .then(function (response) {\n                    if (retryOnFn(attempt, frp.retries, null, response)) {\n                        // eslint-disable-next-line @typescript-eslint/no-use-before-define\n                        retry(attempt, null, response);\n                    }\n                    else {\n                        resolve(response);\n                    }\n                })\n                    .catch(function (error) {\n                    if (retryOnFn(attempt, frp.retries, error, null)) {\n                        // eslint-disable-next-line @typescript-eslint/no-use-before-define\n                        retry(attempt, error, null);\n                    }\n                    else {\n                        reject(error);\n                    }\n                });\n            };\n            function retry(attempt, error, response) {\n                setTimeout(function () {\n                    extendedFetch(++attempt);\n                }, retryDelayFn(attempt, error, response));\n            }\n            extendedFetch(0);\n        });\n    };\n}\nexports.default = default_1;\n//# sourceMappingURL=index.js.map"]},"metadata":{},"sourceType":"script"}