{"ast":null,"code":"\"use strict\";\n\nvar _regeneratorRuntime = require(\"/workspace/0x2Hacks.github.io/candy-machine-ui/node_modules/@babel/runtime/regenerator/index.js\");\n\nvar _asyncToGenerator = require(\"/workspace/0x2Hacks.github.io/candy-machine-ui/node_modules/@babel/runtime/helpers/asyncToGenerator.js\").default;\n\nvar _defineProperty = require(\"/workspace/0x2Hacks.github.io/candy-machine-ui/node_modules/@babel/runtime/helpers/defineProperty.js\").default;\n\nvar _gatewayStatusToCivic, _validationProcessToG;\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.reducer = void 0;\n\nvar react_1 = require(\"react\");\n\nvar status_1 = require(\"../utils/status\");\n\nvar logger_1 = __importDefault(require(\"../logger\"));\n\nvar types_1 = require(\"../types\");\n\nvar config_1 = require(\"../config\");\n\nvar utils_1 = require(\"../useReducer/utils\");\n\nvar gatewayStatusToCivicPassAction = (_gatewayStatusToCivic = {}, _defineProperty(_gatewayStatusToCivic, types_1.GatewayStatus.PROOF_OF_WALLET_OWNERSHIP, types_1.CivicPassMessageAction.PROOF_OF_WALLET_OWNERSHIP), _defineProperty(_gatewayStatusToCivic, types_1.GatewayStatus.IN_REVIEW, types_1.CivicPassMessageAction.TOKEN_IN_REVIEW), _defineProperty(_gatewayStatusToCivic, types_1.GatewayStatus.ERROR, types_1.CivicPassMessageAction.ERROR), _defineProperty(_gatewayStatusToCivic, types_1.GatewayStatus.ACTIVE, types_1.CivicPassMessageAction.TOKEN_ACTIVE), _defineProperty(_gatewayStatusToCivic, types_1.GatewayStatus.REVOKED, types_1.CivicPassMessageAction.TOKEN_REVOKED), _defineProperty(_gatewayStatusToCivic, types_1.GatewayStatus.FROZEN, types_1.CivicPassMessageAction.TOKEN_FROZEN), _defineProperty(_gatewayStatusToCivic, types_1.GatewayStatus.REJECTED, types_1.CivicPassMessageAction.TOKEN_REJECTED), _defineProperty(_gatewayStatusToCivic, types_1.GatewayStatus.LOCATION_NOT_SUPPORTED, types_1.CivicPassMessageAction.FAILED_IP_CHECK), _defineProperty(_gatewayStatusToCivic, types_1.GatewayStatus.VPN_NOT_SUPPORTED, types_1.CivicPassMessageAction.FAILED_VPN_CHECK), _defineProperty(_gatewayStatusToCivic, types_1.GatewayStatus.REFRESH_TOKEN_REQUIRED, types_1.CivicPassMessageAction.REFRESH), _defineProperty(_gatewayStatusToCivic, types_1.GatewayStatus.CHECKING, types_1.CivicPassMessageAction.STATUS), _defineProperty(_gatewayStatusToCivic, types_1.GatewayStatus.NOT_REQUESTED, types_1.CivicPassMessageAction.ISSUANCE), _defineProperty(_gatewayStatusToCivic, types_1.GatewayStatus.COLLECTING_USER_INFORMATION, types_1.CivicPassMessageAction.ISSUANCE), _defineProperty(_gatewayStatusToCivic, types_1.GatewayStatus.VALIDATING_USER_INFORMATION, types_1.CivicPassMessageAction.ISSUANCE), _defineProperty(_gatewayStatusToCivic, types_1.GatewayStatus.USER_INFORMATION_VALIDATED, types_1.CivicPassMessageAction.ISSUANCE), _defineProperty(_gatewayStatusToCivic, types_1.GatewayStatus.USER_INFORMATION_REJECTED, types_1.CivicPassMessageAction.ISSUANCE), _defineProperty(_gatewayStatusToCivic, types_1.ExtendedGatewayStatus.AWAITING_OWNER_TRANSACTION, types_1.CivicPassMessageAction.AWAITING_TRANSACTION_CONFIRMATION), _defineProperty(_gatewayStatusToCivic, types_1.ExtendedGatewayStatus.CHAIN_TIMEOUT_ERROR, types_1.CivicPassMessageAction.CHAIN_ERROR), _gatewayStatusToCivic);\nvar validationProcessToGatewayStatus = (_validationProcessToG = {}, _defineProperty(_validationProcessToG, types_1.ValidationStatus.COLLECTING, types_1.GatewayStatus.COLLECTING_USER_INFORMATION), _defineProperty(_validationProcessToG, types_1.ValidationStatus.PROCESSING, types_1.GatewayStatus.VALIDATING_USER_INFORMATION), _defineProperty(_validationProcessToG, types_1.ValidationStatus.IN_REVIEW, types_1.GatewayStatus.VALIDATING_USER_INFORMATION), _defineProperty(_validationProcessToG, types_1.ValidationStatus.FAILED, types_1.GatewayStatus.USER_INFORMATION_REJECTED), _defineProperty(_validationProcessToG, types_1.ValidationStatus.NOT_FOUND, types_1.GatewayStatus.NOT_REQUESTED), _defineProperty(_validationProcessToG, types_1.ValidationStatus.COMPLETED, types_1.GatewayStatus.USER_INFORMATION_VALIDATED), _validationProcessToG);\n\nvar logDebug = function logDebug(message) {\n  var obj = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;\n  return logger_1.default.debug(\"[useCivicPass] \".concat(message), obj);\n};\n\nvar logError = function logError(message) {\n  var obj = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;\n  return logger_1.default.error(\"[useCivicPass] \".concat(message), obj);\n}; // eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types\n\n\nvar getCivicPassSrcUrl = function getCivicPassSrcUrl(state, status) {\n  var redirectUrl = state.redirectUrl,\n      gatekeeperNetworkAddress = state.gatekeeperNetworkAddress,\n      stage = state.stage,\n      walletAddress = state.walletAddress,\n      civicPass = state.civicPass,\n      chainType = state.chainType,\n      ownerSigns = state.ownerSigns;\n\n  if (!gatekeeperNetworkAddress || !walletAddress) {\n    logError('Required properties not present', {\n      gatekeeperNetworkAddress: gatekeeperNetworkAddress,\n      walletAddress: walletAddress\n    });\n    throw new Error(\"Required properties not present \".concat({\n      gatekeeperNetworkAddress: gatekeeperNetworkAddress,\n      walletAddress: walletAddress\n    }));\n  }\n\n  var civicPassSrcUrl = (0, config_1.getCivicPassEndpoint)(stage);\n  var url = new URL(civicPassSrcUrl);\n  var action = gatewayStatusToCivicPassAction[status];\n  var searchParams = new URLSearchParams(Object.assign(Object.assign({}, civicPass.requestPayload), {\n    redirectUrl: redirectUrl,\n    networkAddress: gatekeeperNetworkAddress,\n    action: action,\n    wallet: walletAddress,\n    chain: chainType,\n    ownerSigns: ownerSigns ? 'true' : 'false'\n  }));\n  logDebug('Civic pass query params', {\n    searchParams: searchParams.toString(),\n    gatewayStatus: (0, status_1.statusDisplayValue)(status)\n  });\n  return \"\".concat(url.href, \"?\").concat(searchParams.toString());\n};\n\nvar reducer = function reducer(state, action) {\n  var _a;\n\n  switch (action.type) {\n    case 'civicPass_check_token_status':\n      {\n        return Object.assign(Object.assign({}, state), {\n          iframeMinimized: !((_a = state.options) === null || _a === void 0 ? void 0 : _a.autoShowModal),\n          renderIframe: true,\n          iframeSrcUrl: state.civicPass.status === types_1.CivicPassIssuanceStatus.REQUESTED ? state.iframeSrcUrl : getCivicPassSrcUrl(state, (0, utils_1.statusFromToken)(state, action.token))\n        });\n      }\n\n    case 'civicPass_check_status':\n      {\n        return Object.assign(Object.assign({}, state), {\n          iframeMinimized: true,\n          renderIframe: true,\n          gatewayStatus: types_1.GatewayStatus.CHECKING,\n          iframeSrcUrl: getCivicPassSrcUrl(state, types_1.GatewayStatus.CHECKING)\n        });\n      }\n\n    case 'civicPass_check_status_complete':\n      {\n        var payload = action.payload.payload;\n        var status = payload.status;\n        var gatewayStatus = validationProcessToGatewayStatus[status];\n        return Object.assign(Object.assign({}, state), {\n          iframeMinimized: true,\n          renderIframe: false,\n          gatewayStatus: gatewayStatus\n        });\n      }\n\n    case 'userInteraction_check_gatewayToken_status':\n      {\n        return Object.assign(Object.assign({}, state), {\n          iframeMinimized: false,\n          renderIframe: true,\n          iframeSrcUrl: state.civicPass.status === types_1.CivicPassIssuanceStatus.REQUESTED ? state.iframeSrcUrl : getCivicPassSrcUrl(state, (0, utils_1.statusFromToken)(state, action.token))\n        });\n      }\n\n    case 'civicPass_close':\n      {\n        var _gatewayStatus = state.gatewayStatus;\n        var requiresRefresh = _gatewayStatus === types_1.GatewayStatus.REFRESH_TOKEN_REQUIRED || _gatewayStatus === types_1.GatewayStatus.PROOF_OF_WALLET_OWNERSHIP; // keep iframe in mounted while civic pass is requested, or if we are showing the awaiting owner tx screen\n        // as the internal iframe state needs to be preserved\n\n        var renderIframe = state.civicPass.status === types_1.CivicPassIssuanceStatus.REQUESTED || _gatewayStatus === types_1.ExtendedGatewayStatus.AWAITING_OWNER_TRANSACTION;\n        return Object.assign({}, renderIframe ? Object.assign(Object.assign({}, state), {\n          iframeMinimized: true,\n          renderIframe: renderIframe\n        }) : Object.assign(Object.assign({}, state), {\n          iframeMinimized: true,\n          renderIframe: renderIframe,\n          refreshTokenState: requiresRefresh ? state.refreshTokenState : types_1.RefreshTokenState.COMPLETED\n        }));\n      }\n\n    case 'civicPass_in_progress':\n      {\n        return Object.assign(Object.assign({}, state), {\n          gatewayStatus: types_1.GatewayStatus.COLLECTING_USER_INFORMATION,\n          renderIframe: true,\n          iframeMinimized: false,\n          civicPass: Object.assign(Object.assign({}, state.civicPass), {\n            status: types_1.CivicPassIssuanceStatus.REQUESTED\n          })\n        });\n      }\n\n    case 'civicPass_issuance_success':\n      {\n        var ownerSigns = state.ownerSigns;\n        var _action$payload = action.payload,\n            _payload = _action$payload.payload,\n            requiresProofOfWalletOwnership = _action$payload.requiresProofOfWalletOwnership;\n        var shouldRequestPowo = ownerSigns ? false : requiresProofOfWalletOwnership;\n\n        var _gatewayStatus2 = shouldRequestPowo ? types_1.GatewayStatus.PROOF_OF_WALLET_OWNERSHIP : types_1.GatewayStatus.IN_REVIEW;\n\n        return Object.assign(Object.assign({}, state), {\n          gatewayStatus: _gatewayStatus2,\n          renderIframe: !ownerSigns,\n          iframeMinimized: ownerSigns,\n          powoRequested: 'solana',\n          iframeSrcUrl: getCivicPassSrcUrl(state, _gatewayStatus2),\n          civicPass: Object.assign(Object.assign({}, state.civicPass), {\n            status: types_1.CivicPassIssuanceStatus.VERIFIED,\n            responsePayload: _defineProperty({}, types_1.CivicPassMessageAction.ISSUANCE, {\n              payload: _payload,\n              requiresProofOfWalletOwnership: shouldRequestPowo\n            })\n          })\n        });\n      }\n\n    case 'civicPass_issuance_failure':\n      return Object.assign(Object.assign({}, (0, utils_1.resetState)(state)), {\n        iframeMinimized: false,\n        renderIframe: true,\n        gatewayStatus: types_1.GatewayStatus.ERROR\n      });\n\n    case 'civicPass_requested_retries_exhausted':\n      return Object.assign(Object.assign({}, (0, utils_1.resetState)(state)), {\n        refreshTokenState: types_1.RefreshTokenState.NOT_REQUIRED,\n        iframeMinimized: false,\n        renderIframe: true,\n        gatewayStatus: types_1.GatewayStatus.ERROR,\n        iframeSrcUrl: getCivicPassSrcUrl(state, types_1.GatewayStatus.ERROR)\n      });\n\n    case 'civicPass_error_user_retry':\n      return Object.assign(Object.assign({}, (0, utils_1.resetState)(state)), {\n        iframeMinimized: false,\n        renderIframe: true,\n        gatewayStatus: types_1.GatewayStatus.NOT_REQUESTED,\n        iframeSrcUrl: getCivicPassSrcUrl(state, types_1.GatewayStatus.NOT_REQUESTED)\n      });\n\n    case 'civicPass_issuance_cancelled':\n      return Object.assign(Object.assign({}, (0, utils_1.resetState)(state)), {\n        gatewayStatus: types_1.GatewayStatus.NOT_REQUESTED\n      });\n\n    case 'civicPass_refresh_success':\n      {\n        var _ownerSigns = state.ownerSigns;\n        var _action$payload2 = action.payload,\n            _payload2 = _action$payload2.payload,\n            _requiresProofOfWalletOwnership = _action$payload2.requiresProofOfWalletOwnership;\n\n        var _shouldRequestPowo = _ownerSigns ? false : _requiresProofOfWalletOwnership;\n\n        var _gatewayStatus3 = _shouldRequestPowo ? types_1.GatewayStatus.PROOF_OF_WALLET_OWNERSHIP : types_1.GatewayStatus.IN_REVIEW;\n\n        return Object.assign(Object.assign({}, state), {\n          gatewayStatus: _gatewayStatus3,\n          renderIframe: !_ownerSigns,\n          iframeMinimized: _ownerSigns,\n          iframeSrcUrl: getCivicPassSrcUrl(state, _gatewayStatus3),\n          refreshTokenState: types_1.RefreshTokenState.IN_PROGRESS,\n          civicPass: Object.assign(Object.assign({}, state.civicPass), {\n            responsePayload: _defineProperty({}, types_1.CivicPassMessageAction.REFRESH, {\n              payload: _payload2,\n              requiresProofOfWalletOwnership: _shouldRequestPowo\n            })\n          })\n        });\n      }\n\n    case 'civicPass_refresh_cancelled':\n      return Object.assign(Object.assign({}, (0, utils_1.resetState)(state)), {\n        refreshTokenState: types_1.RefreshTokenState.CANCELLED,\n        gatewayStatus: types_1.GatewayStatus.REFRESH_TOKEN_REQUIRED\n      });\n\n    case 'civicPass_refresh_failure':\n      return Object.assign(Object.assign({}, (0, utils_1.resetState)(state)), {\n        refreshTokenState: types_1.RefreshTokenState.FAILED,\n        gatewayStatus: types_1.GatewayStatus.ERROR,\n        civicPass: Object.assign(Object.assign({}, state.civicPass), {\n          responsePayload: undefined\n        })\n      });\n\n    case 'civicPass_location_not_supported':\n      return Object.assign(Object.assign({}, state), {\n        iframeMinimized: true,\n        renderIframe: false,\n        gatewayStatus: state.gatewayStatus,\n        refreshTokenState: state.gatekeeperRecordState === types_1.GatekeeperAPIStatus.ISSUED_LOCATION_NOT_SUPPORTED ? types_1.RefreshTokenState.REQUIRES_POWO : state.refreshTokenState\n      });\n\n    case 'civicPass_vpn_not_supported':\n      return Object.assign(Object.assign({}, state), {\n        iframeMinimized: true,\n        renderIframe: false,\n        gatewayStatus: state.gatewayStatus\n      });\n\n    case 'civicPass_awaiting_owner_transaction':\n      return Object.assign(Object.assign({}, state), {\n        iframeMinimized: false,\n        renderIframe: true,\n        gatewayStatus: types_1.ExtendedGatewayStatus.AWAITING_OWNER_TRANSACTION,\n        iframeSrcUrl: getCivicPassSrcUrl(state, types_1.ExtendedGatewayStatus.AWAITING_OWNER_TRANSACTION)\n      });\n\n    case 'civicPass_owner_transaction_timeout':\n      return Object.assign(Object.assign({}, state), {\n        iframeMinimized: false,\n        renderIframe: true,\n        gatewayStatus: types_1.ExtendedGatewayStatus.CHAIN_TIMEOUT_ERROR,\n        iframeSrcUrl: getCivicPassSrcUrl(state, types_1.ExtendedGatewayStatus.CHAIN_TIMEOUT_ERROR)\n      });\n\n    default:\n      return state;\n  }\n};\n\nexports.reducer = reducer;\n\nvar useCivicPass = function useCivicPass(_ref, state, dispatch) {\n  var wallet = _ref.wallet;\n  var gatekeeperRecordState = state.gatekeeperRecordState;\n\n  var getActionForIssuanceResponse = function getActionForIssuanceResponse(response) {\n    var _actions;\n\n    var actions = (_actions = {}, _defineProperty(_actions, types_1.CivicPassMessageEventResult.SUCCESS, {\n      type: 'civicPass_issuance_success',\n      payload: response\n    }), _defineProperty(_actions, types_1.CivicPassMessageEventResult.FAILURE, {\n      type: 'civicPass_issuance_failure'\n    }), _defineProperty(_actions, types_1.CivicPassMessageEventResult.CANCELLED, {\n      type: 'civicPass_issuance_cancelled'\n    }), _defineProperty(_actions, types_1.CivicPassMessageEventResult.IN_PROGRESS, {\n      type: 'civicPass_in_progress'\n    }), _actions);\n    return actions[response.event];\n  };\n\n  var getActionForRefreshResponse = function getActionForRefreshResponse(response) {\n    var _actions2;\n\n    var actions = (_actions2 = {}, _defineProperty(_actions2, types_1.CivicPassMessageEventResult.SUCCESS, {\n      type: 'civicPass_refresh_success',\n      payload: response\n    }), _defineProperty(_actions2, types_1.CivicPassMessageEventResult.CANCELLED, {\n      type: 'civicPass_refresh_cancelled'\n    }), _defineProperty(_actions2, types_1.CivicPassMessageEventResult.FAILURE, {\n      type: 'civicPass_refresh_failure'\n    }), _actions2);\n    return actions[response.event];\n  };\n\n  var getActionForPowoResponse = function getActionForPowoResponse(response) {\n    var actions = _defineProperty({}, types_1.CivicPassMessageEventResult.SUCCESS, {\n      type: 'powoComplete'\n    });\n\n    return actions[response.event];\n  };\n\n  var getActionForLocationNotSupportedResponse = function getActionForLocationNotSupportedResponse(response) {\n    var actions = _defineProperty({}, types_1.CivicPassMessageEventResult.SUCCESS, {\n      type: 'civicPass_location_not_supported'\n    });\n\n    return actions[response.event];\n  };\n\n  var getActionForVpnNotSupportedResponse = function getActionForVpnNotSupportedResponse(response) {\n    var actions = _defineProperty({}, types_1.CivicPassMessageEventResult.SUCCESS, {\n      type: 'civicPass_vpn_not_supported'\n    });\n\n    return actions[response.event];\n  };\n\n  var getActionForStaticResponse = function getActionForStaticResponse(response) {\n    var _actions6;\n\n    var actions = (_actions6 = {}, _defineProperty(_actions6, types_1.CivicPassMessageEventResult.SUCCESS, {\n      type: 'civicPass_close'\n    }), _defineProperty(_actions6, types_1.CivicPassMessageEventResult.FAILURE, {\n      type: 'civicPass_error_user_retry'\n    }), _actions6);\n    var returnAction = actions[response.event];\n    return returnAction;\n  };\n\n  var getActionForStatusResponse = function getActionForStatusResponse(response) {\n    var actions = _defineProperty({}, types_1.CivicPassMessageEventResult.SUCCESS, {\n      type: 'civicPass_check_status_complete',\n      payload: response\n    });\n\n    return actions[response.event];\n  };\n\n  var dispatchComplianceEventResult = function dispatchComplianceEventResult(response) {\n    var _actions8;\n\n    var actions = (_actions8 = {}, _defineProperty(_actions8, types_1.CivicPassMessageAction.ISSUANCE, getActionForIssuanceResponse(response)), _defineProperty(_actions8, types_1.CivicPassMessageAction.PROOF_OF_WALLET_OWNERSHIP, getActionForPowoResponse(response)), _defineProperty(_actions8, types_1.CivicPassMessageAction.TOKEN_IN_REVIEW, getActionForStaticResponse(response)), _defineProperty(_actions8, types_1.CivicPassMessageAction.TOKEN_ACTIVE, getActionForStaticResponse(response)), _defineProperty(_actions8, types_1.CivicPassMessageAction.TOKEN_FROZEN, getActionForStaticResponse(response)), _defineProperty(_actions8, types_1.CivicPassMessageAction.TOKEN_REJECTED, getActionForStaticResponse(response)), _defineProperty(_actions8, types_1.CivicPassMessageAction.TOKEN_REVOKED, getActionForStaticResponse(response)), _defineProperty(_actions8, types_1.CivicPassMessageAction.FAILED_IP_CHECK, getActionForLocationNotSupportedResponse(response)), _defineProperty(_actions8, types_1.CivicPassMessageAction.FAILED_VPN_CHECK, getActionForVpnNotSupportedResponse(response)), _defineProperty(_actions8, types_1.CivicPassMessageAction.REFRESH, getActionForRefreshResponse(response)), _defineProperty(_actions8, types_1.CivicPassMessageAction.STATUS, getActionForStatusResponse(response)), _defineProperty(_actions8, types_1.CivicPassMessageAction.ERROR, getActionForStaticResponse(response)), _defineProperty(_actions8, types_1.CivicPassMessageAction.CHAIN_ERROR, getActionForStaticResponse(response)), _actions8);\n    var action = actions[response.action];\n\n    if (action) {\n      logDebug('Successfully processed compliance event with action', action);\n      dispatch(action);\n    }\n  };\n  /**\n   * Listen for post messages from the compliance iframe and dispatch events\n   * based on the event type\n   */\n\n\n  (0, react_1.useEffect)(function () {\n    if (wallet && wallet.publicKey) {\n      logDebug('Current state', state);\n\n      var handler = /*#__PURE__*/function () {\n        var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(response) {\n          return _regeneratorRuntime.wrap(function _callee$(_context) {\n            while (1) {\n              switch (_context.prev = _context.next) {\n                case 0:\n                  dispatchComplianceEventResult(response.data);\n\n                case 1:\n                case \"end\":\n                  return _context.stop();\n              }\n            }\n          }, _callee);\n        }));\n\n        return function handler(_x) {\n          return _ref2.apply(this, arguments);\n        };\n      }();\n\n      window.addEventListener('message', handler);\n      return function () {\n        logDebug('Removing event listener for compliance');\n        return window.removeEventListener('message', handler);\n      };\n    }\n\n    return function () {};\n  }, []);\n  /**\n   * We do not have a token and user is connecting from an unsupported country,\n   * so we show the country not supported screen\n   */\n\n  (0, react_1.useEffect)(function () {\n    if (gatekeeperRecordState === types_1.GatekeeperAPIStatus.LOCATION_NOT_SUPPORTED || gatekeeperRecordState === types_1.GatekeeperAPIStatus.VPN_NOT_SUPPORTED) {\n      dispatch({\n        type: 'civicPass_check_token_status'\n      });\n    }\n  }, [gatekeeperRecordState]);\n  /**\n   * Check for the ongoing KYC status\n   */\n\n  (0, react_1.useEffect)(function () {\n    if (gatekeeperRecordState === types_1.GatekeeperAPIStatus.NOT_REQUESTED) {\n      dispatch({\n        type: 'civicPass_check_status'\n      });\n    }\n  }, [gatekeeperRecordState]);\n  return {\n    dispatchComplianceEventResult: dispatchComplianceEventResult\n  };\n};\n\nexports.default = useCivicPass;","map":{"version":3,"sources":["/workspace/0x2Hacks.github.io/candy-machine-ui/node_modules/@civic/common-gateway-react/dist/esm/useHooks/useCivicPass.js"],"names":["__importDefault","mod","__esModule","Object","defineProperty","exports","value","reducer","react_1","require","status_1","logger_1","types_1","config_1","utils_1","gatewayStatusToCivicPassAction","GatewayStatus","PROOF_OF_WALLET_OWNERSHIP","CivicPassMessageAction","IN_REVIEW","TOKEN_IN_REVIEW","ERROR","ACTIVE","TOKEN_ACTIVE","REVOKED","TOKEN_REVOKED","FROZEN","TOKEN_FROZEN","REJECTED","TOKEN_REJECTED","LOCATION_NOT_SUPPORTED","FAILED_IP_CHECK","VPN_NOT_SUPPORTED","FAILED_VPN_CHECK","REFRESH_TOKEN_REQUIRED","REFRESH","CHECKING","STATUS","NOT_REQUESTED","ISSUANCE","COLLECTING_USER_INFORMATION","VALIDATING_USER_INFORMATION","USER_INFORMATION_VALIDATED","USER_INFORMATION_REJECTED","ExtendedGatewayStatus","AWAITING_OWNER_TRANSACTION","AWAITING_TRANSACTION_CONFIRMATION","CHAIN_TIMEOUT_ERROR","CHAIN_ERROR","validationProcessToGatewayStatus","ValidationStatus","COLLECTING","PROCESSING","FAILED","NOT_FOUND","COMPLETED","logDebug","message","obj","default","debug","logError","error","getCivicPassSrcUrl","state","status","redirectUrl","gatekeeperNetworkAddress","stage","walletAddress","civicPass","chainType","ownerSigns","Error","civicPassSrcUrl","getCivicPassEndpoint","url","URL","action","searchParams","URLSearchParams","assign","requestPayload","networkAddress","wallet","chain","toString","gatewayStatus","statusDisplayValue","href","_a","type","iframeMinimized","options","autoShowModal","renderIframe","iframeSrcUrl","CivicPassIssuanceStatus","REQUESTED","statusFromToken","token","payload","requiresRefresh","refreshTokenState","RefreshTokenState","requiresProofOfWalletOwnership","shouldRequestPowo","powoRequested","VERIFIED","responsePayload","resetState","NOT_REQUIRED","IN_PROGRESS","CANCELLED","undefined","gatekeeperRecordState","GatekeeperAPIStatus","ISSUED_LOCATION_NOT_SUPPORTED","REQUIRES_POWO","useCivicPass","dispatch","getActionForIssuanceResponse","response","actions","CivicPassMessageEventResult","SUCCESS","FAILURE","event","getActionForRefreshResponse","getActionForPowoResponse","getActionForLocationNotSupportedResponse","getActionForVpnNotSupportedResponse","getActionForStaticResponse","returnAction","getActionForStatusResponse","dispatchComplianceEventResult","useEffect","publicKey","handler","data","window","addEventListener","removeEventListener"],"mappings":"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","sourcesContent":["\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.reducer = void 0;\nconst react_1 = require(\"react\");\nconst status_1 = require(\"../utils/status\");\nconst logger_1 = __importDefault(require(\"../logger\"));\nconst types_1 = require(\"../types\");\nconst config_1 = require(\"../config\");\nconst utils_1 = require(\"../useReducer/utils\");\nconst gatewayStatusToCivicPassAction = {\n    [types_1.GatewayStatus.PROOF_OF_WALLET_OWNERSHIP]: types_1.CivicPassMessageAction.PROOF_OF_WALLET_OWNERSHIP,\n    [types_1.GatewayStatus.IN_REVIEW]: types_1.CivicPassMessageAction.TOKEN_IN_REVIEW,\n    [types_1.GatewayStatus.ERROR]: types_1.CivicPassMessageAction.ERROR,\n    [types_1.GatewayStatus.ACTIVE]: types_1.CivicPassMessageAction.TOKEN_ACTIVE,\n    [types_1.GatewayStatus.REVOKED]: types_1.CivicPassMessageAction.TOKEN_REVOKED,\n    [types_1.GatewayStatus.FROZEN]: types_1.CivicPassMessageAction.TOKEN_FROZEN,\n    [types_1.GatewayStatus.REJECTED]: types_1.CivicPassMessageAction.TOKEN_REJECTED,\n    [types_1.GatewayStatus.LOCATION_NOT_SUPPORTED]: types_1.CivicPassMessageAction.FAILED_IP_CHECK,\n    [types_1.GatewayStatus.VPN_NOT_SUPPORTED]: types_1.CivicPassMessageAction.FAILED_VPN_CHECK,\n    [types_1.GatewayStatus.REFRESH_TOKEN_REQUIRED]: types_1.CivicPassMessageAction.REFRESH,\n    [types_1.GatewayStatus.CHECKING]: types_1.CivicPassMessageAction.STATUS,\n    [types_1.GatewayStatus.NOT_REQUESTED]: types_1.CivicPassMessageAction.ISSUANCE,\n    [types_1.GatewayStatus.COLLECTING_USER_INFORMATION]: types_1.CivicPassMessageAction.ISSUANCE,\n    [types_1.GatewayStatus.VALIDATING_USER_INFORMATION]: types_1.CivicPassMessageAction.ISSUANCE,\n    [types_1.GatewayStatus.USER_INFORMATION_VALIDATED]: types_1.CivicPassMessageAction.ISSUANCE,\n    [types_1.GatewayStatus.USER_INFORMATION_REJECTED]: types_1.CivicPassMessageAction.ISSUANCE,\n    [types_1.ExtendedGatewayStatus.AWAITING_OWNER_TRANSACTION]: types_1.CivicPassMessageAction.AWAITING_TRANSACTION_CONFIRMATION,\n    [types_1.ExtendedGatewayStatus.CHAIN_TIMEOUT_ERROR]: types_1.CivicPassMessageAction.CHAIN_ERROR,\n};\nconst validationProcessToGatewayStatus = {\n    [types_1.ValidationStatus.COLLECTING]: types_1.GatewayStatus.COLLECTING_USER_INFORMATION,\n    [types_1.ValidationStatus.PROCESSING]: types_1.GatewayStatus.VALIDATING_USER_INFORMATION,\n    [types_1.ValidationStatus.IN_REVIEW]: types_1.GatewayStatus.VALIDATING_USER_INFORMATION,\n    [types_1.ValidationStatus.FAILED]: types_1.GatewayStatus.USER_INFORMATION_REJECTED,\n    [types_1.ValidationStatus.NOT_FOUND]: types_1.GatewayStatus.NOT_REQUESTED,\n    [types_1.ValidationStatus.COMPLETED]: types_1.GatewayStatus.USER_INFORMATION_VALIDATED,\n};\nconst logDebug = (message, obj = null) => logger_1.default.debug(`[useCivicPass] ${message}`, obj);\nconst logError = (message, obj = null) => logger_1.default.error(`[useCivicPass] ${message}`, obj);\n// eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types\nconst getCivicPassSrcUrl = (state, status) => {\n    const { redirectUrl, gatekeeperNetworkAddress, stage, walletAddress, civicPass, chainType, ownerSigns } = state;\n    if (!gatekeeperNetworkAddress || !walletAddress) {\n        logError('Required properties not present', { gatekeeperNetworkAddress, walletAddress });\n        throw new Error(`Required properties not present ${{ gatekeeperNetworkAddress, walletAddress }}`);\n    }\n    const civicPassSrcUrl = (0, config_1.getCivicPassEndpoint)(stage);\n    const url = new URL(civicPassSrcUrl);\n    const action = gatewayStatusToCivicPassAction[status];\n    const searchParams = new URLSearchParams(Object.assign(Object.assign({}, civicPass.requestPayload), { redirectUrl, networkAddress: gatekeeperNetworkAddress, action, wallet: walletAddress, chain: chainType, ownerSigns: ownerSigns ? 'true' : 'false' }));\n    logDebug('Civic pass query params', {\n        searchParams: searchParams.toString(),\n        gatewayStatus: (0, status_1.statusDisplayValue)(status),\n    });\n    return `${url.href}?${searchParams.toString()}`;\n};\nconst reducer = (state, action) => {\n    var _a;\n    switch (action.type) {\n        case 'civicPass_check_token_status': {\n            return Object.assign(Object.assign({}, state), { iframeMinimized: !((_a = state.options) === null || _a === void 0 ? void 0 : _a.autoShowModal), renderIframe: true, iframeSrcUrl: state.civicPass.status === types_1.CivicPassIssuanceStatus.REQUESTED\n                    ? state.iframeSrcUrl\n                    : getCivicPassSrcUrl(state, (0, utils_1.statusFromToken)(state, action.token)) });\n        }\n        case 'civicPass_check_status': {\n            return Object.assign(Object.assign({}, state), { iframeMinimized: true, renderIframe: true, gatewayStatus: types_1.GatewayStatus.CHECKING, iframeSrcUrl: getCivicPassSrcUrl(state, types_1.GatewayStatus.CHECKING) });\n        }\n        case 'civicPass_check_status_complete': {\n            const { payload } = action.payload;\n            const { status } = payload;\n            const gatewayStatus = validationProcessToGatewayStatus[status];\n            return Object.assign(Object.assign({}, state), { iframeMinimized: true, renderIframe: false, gatewayStatus });\n        }\n        case 'userInteraction_check_gatewayToken_status': {\n            return Object.assign(Object.assign({}, state), { iframeMinimized: false, renderIframe: true, iframeSrcUrl: state.civicPass.status === types_1.CivicPassIssuanceStatus.REQUESTED\n                    ? state.iframeSrcUrl\n                    : getCivicPassSrcUrl(state, (0, utils_1.statusFromToken)(state, action.token)) });\n        }\n        case 'civicPass_close': {\n            const { gatewayStatus } = state;\n            const requiresRefresh = gatewayStatus === types_1.GatewayStatus.REFRESH_TOKEN_REQUIRED ||\n                gatewayStatus === types_1.GatewayStatus.PROOF_OF_WALLET_OWNERSHIP;\n            // keep iframe in mounted while civic pass is requested, or if we are showing the awaiting owner tx screen\n            // as the internal iframe state needs to be preserved\n            const renderIframe = state.civicPass.status === types_1.CivicPassIssuanceStatus.REQUESTED ||\n                gatewayStatus === types_1.ExtendedGatewayStatus.AWAITING_OWNER_TRANSACTION;\n            return Object.assign({}, (renderIframe\n                ? Object.assign(Object.assign({}, state), { iframeMinimized: true, renderIframe }) : Object.assign(Object.assign({}, state), { iframeMinimized: true, renderIframe, refreshTokenState: requiresRefresh ? state.refreshTokenState : types_1.RefreshTokenState.COMPLETED })));\n        }\n        case 'civicPass_in_progress': {\n            return Object.assign(Object.assign({}, state), { gatewayStatus: types_1.GatewayStatus.COLLECTING_USER_INFORMATION, renderIframe: true, iframeMinimized: false, civicPass: Object.assign(Object.assign({}, state.civicPass), { status: types_1.CivicPassIssuanceStatus.REQUESTED }) });\n        }\n        case 'civicPass_issuance_success': {\n            const { ownerSigns } = state;\n            const { payload, requiresProofOfWalletOwnership } = action.payload;\n            const shouldRequestPowo = ownerSigns ? false : requiresProofOfWalletOwnership;\n            const gatewayStatus = shouldRequestPowo ? types_1.GatewayStatus.PROOF_OF_WALLET_OWNERSHIP : types_1.GatewayStatus.IN_REVIEW;\n            return Object.assign(Object.assign({}, state), { gatewayStatus, renderIframe: !ownerSigns, iframeMinimized: ownerSigns, powoRequested: 'solana', iframeSrcUrl: getCivicPassSrcUrl(state, gatewayStatus), civicPass: Object.assign(Object.assign({}, state.civicPass), { status: types_1.CivicPassIssuanceStatus.VERIFIED, responsePayload: {\n                        [types_1.CivicPassMessageAction.ISSUANCE]: {\n                            payload,\n                            requiresProofOfWalletOwnership: shouldRequestPowo,\n                        },\n                    } }) });\n        }\n        case 'civicPass_issuance_failure':\n            return Object.assign(Object.assign({}, (0, utils_1.resetState)(state)), { iframeMinimized: false, renderIframe: true, gatewayStatus: types_1.GatewayStatus.ERROR });\n        case 'civicPass_requested_retries_exhausted':\n            return Object.assign(Object.assign({}, (0, utils_1.resetState)(state)), { refreshTokenState: types_1.RefreshTokenState.NOT_REQUIRED, iframeMinimized: false, renderIframe: true, gatewayStatus: types_1.GatewayStatus.ERROR, iframeSrcUrl: getCivicPassSrcUrl(state, types_1.GatewayStatus.ERROR) });\n        case 'civicPass_error_user_retry':\n            return Object.assign(Object.assign({}, (0, utils_1.resetState)(state)), { iframeMinimized: false, renderIframe: true, gatewayStatus: types_1.GatewayStatus.NOT_REQUESTED, iframeSrcUrl: getCivicPassSrcUrl(state, types_1.GatewayStatus.NOT_REQUESTED) });\n        case 'civicPass_issuance_cancelled':\n            return Object.assign(Object.assign({}, (0, utils_1.resetState)(state)), { gatewayStatus: types_1.GatewayStatus.NOT_REQUESTED });\n        case 'civicPass_refresh_success': {\n            const { ownerSigns } = state;\n            const { payload, requiresProofOfWalletOwnership } = action.payload;\n            const shouldRequestPowo = ownerSigns ? false : requiresProofOfWalletOwnership;\n            const gatewayStatus = shouldRequestPowo ? types_1.GatewayStatus.PROOF_OF_WALLET_OWNERSHIP : types_1.GatewayStatus.IN_REVIEW;\n            return Object.assign(Object.assign({}, state), { gatewayStatus, renderIframe: !ownerSigns, iframeMinimized: ownerSigns, iframeSrcUrl: getCivicPassSrcUrl(state, gatewayStatus), refreshTokenState: types_1.RefreshTokenState.IN_PROGRESS, civicPass: Object.assign(Object.assign({}, state.civicPass), { responsePayload: {\n                        [types_1.CivicPassMessageAction.REFRESH]: {\n                            payload,\n                            requiresProofOfWalletOwnership: shouldRequestPowo,\n                        },\n                    } }) });\n        }\n        case 'civicPass_refresh_cancelled':\n            return Object.assign(Object.assign({}, (0, utils_1.resetState)(state)), { refreshTokenState: types_1.RefreshTokenState.CANCELLED, gatewayStatus: types_1.GatewayStatus.REFRESH_TOKEN_REQUIRED });\n        case 'civicPass_refresh_failure':\n            return Object.assign(Object.assign({}, (0, utils_1.resetState)(state)), { refreshTokenState: types_1.RefreshTokenState.FAILED, gatewayStatus: types_1.GatewayStatus.ERROR, civicPass: Object.assign(Object.assign({}, state.civicPass), { responsePayload: undefined }) });\n        case 'civicPass_location_not_supported':\n            return Object.assign(Object.assign({}, state), { iframeMinimized: true, renderIframe: false, gatewayStatus: state.gatewayStatus, refreshTokenState: state.gatekeeperRecordState === types_1.GatekeeperAPIStatus.ISSUED_LOCATION_NOT_SUPPORTED\n                    ? types_1.RefreshTokenState.REQUIRES_POWO\n                    : state.refreshTokenState });\n        case 'civicPass_vpn_not_supported':\n            return Object.assign(Object.assign({}, state), { iframeMinimized: true, renderIframe: false, gatewayStatus: state.gatewayStatus });\n        case 'civicPass_awaiting_owner_transaction':\n            return Object.assign(Object.assign({}, state), { iframeMinimized: false, renderIframe: true, gatewayStatus: types_1.ExtendedGatewayStatus.AWAITING_OWNER_TRANSACTION, iframeSrcUrl: getCivicPassSrcUrl(state, types_1.ExtendedGatewayStatus.AWAITING_OWNER_TRANSACTION) });\n        case 'civicPass_owner_transaction_timeout':\n            return Object.assign(Object.assign({}, state), { iframeMinimized: false, renderIframe: true, gatewayStatus: types_1.ExtendedGatewayStatus.CHAIN_TIMEOUT_ERROR, iframeSrcUrl: getCivicPassSrcUrl(state, types_1.ExtendedGatewayStatus.CHAIN_TIMEOUT_ERROR) });\n        default:\n            return state;\n    }\n};\nexports.reducer = reducer;\nconst useCivicPass = ({ wallet }, state, dispatch) => {\n    const { gatekeeperRecordState } = state;\n    const getActionForIssuanceResponse = (response) => {\n        const actions = {\n            [types_1.CivicPassMessageEventResult.SUCCESS]: {\n                type: 'civicPass_issuance_success',\n                payload: response,\n            },\n            [types_1.CivicPassMessageEventResult.FAILURE]: {\n                type: 'civicPass_issuance_failure',\n            },\n            [types_1.CivicPassMessageEventResult.CANCELLED]: {\n                type: 'civicPass_issuance_cancelled',\n            },\n            [types_1.CivicPassMessageEventResult.IN_PROGRESS]: {\n                type: 'civicPass_in_progress',\n            },\n        };\n        return actions[response.event];\n    };\n    const getActionForRefreshResponse = (response) => {\n        const actions = {\n            [types_1.CivicPassMessageEventResult.SUCCESS]: {\n                type: 'civicPass_refresh_success',\n                payload: response,\n            },\n            [types_1.CivicPassMessageEventResult.CANCELLED]: {\n                type: 'civicPass_refresh_cancelled',\n            },\n            [types_1.CivicPassMessageEventResult.FAILURE]: {\n                type: 'civicPass_refresh_failure',\n            },\n        };\n        return actions[response.event];\n    };\n    const getActionForPowoResponse = (response) => {\n        const actions = {\n            [types_1.CivicPassMessageEventResult.SUCCESS]: {\n                type: 'powoComplete',\n            },\n        };\n        return actions[response.event];\n    };\n    const getActionForLocationNotSupportedResponse = (response) => {\n        const actions = {\n            [types_1.CivicPassMessageEventResult.SUCCESS]: {\n                type: 'civicPass_location_not_supported',\n            },\n        };\n        return actions[response.event];\n    };\n    const getActionForVpnNotSupportedResponse = (response) => {\n        const actions = {\n            [types_1.CivicPassMessageEventResult.SUCCESS]: {\n                type: 'civicPass_vpn_not_supported',\n            },\n        };\n        return actions[response.event];\n    };\n    const getActionForStaticResponse = (response) => {\n        const actions = {\n            [types_1.CivicPassMessageEventResult.SUCCESS]: {\n                type: 'civicPass_close',\n            },\n            [types_1.CivicPassMessageEventResult.FAILURE]: {\n                type: 'civicPass_error_user_retry',\n            },\n        };\n        const returnAction = actions[response.event];\n        return returnAction;\n    };\n    const getActionForStatusResponse = (response) => {\n        const actions = {\n            [types_1.CivicPassMessageEventResult.SUCCESS]: {\n                type: 'civicPass_check_status_complete',\n                payload: response,\n            },\n        };\n        return actions[response.event];\n    };\n    const dispatchComplianceEventResult = (response) => {\n        const actions = {\n            [types_1.CivicPassMessageAction.ISSUANCE]: getActionForIssuanceResponse(response),\n            [types_1.CivicPassMessageAction.PROOF_OF_WALLET_OWNERSHIP]: getActionForPowoResponse(response),\n            [types_1.CivicPassMessageAction.TOKEN_IN_REVIEW]: getActionForStaticResponse(response),\n            [types_1.CivicPassMessageAction.TOKEN_ACTIVE]: getActionForStaticResponse(response),\n            [types_1.CivicPassMessageAction.TOKEN_FROZEN]: getActionForStaticResponse(response),\n            [types_1.CivicPassMessageAction.TOKEN_REJECTED]: getActionForStaticResponse(response),\n            [types_1.CivicPassMessageAction.TOKEN_REVOKED]: getActionForStaticResponse(response),\n            [types_1.CivicPassMessageAction.FAILED_IP_CHECK]: getActionForLocationNotSupportedResponse(response),\n            [types_1.CivicPassMessageAction.FAILED_VPN_CHECK]: getActionForVpnNotSupportedResponse(response),\n            [types_1.CivicPassMessageAction.REFRESH]: getActionForRefreshResponse(response),\n            [types_1.CivicPassMessageAction.STATUS]: getActionForStatusResponse(response),\n            [types_1.CivicPassMessageAction.ERROR]: getActionForStaticResponse(response),\n            [types_1.CivicPassMessageAction.CHAIN_ERROR]: getActionForStaticResponse(response),\n        };\n        const action = actions[response.action];\n        if (action) {\n            logDebug('Successfully processed compliance event with action', action);\n            dispatch(action);\n        }\n    };\n    /**\n     * Listen for post messages from the compliance iframe and dispatch events\n     * based on the event type\n     */\n    (0, react_1.useEffect)(() => {\n        if (wallet && wallet.publicKey) {\n            logDebug('Current state', state);\n            const handler = async (response) => {\n                dispatchComplianceEventResult(response.data);\n            };\n            window.addEventListener('message', handler);\n            return () => {\n                logDebug('Removing event listener for compliance');\n                return window.removeEventListener('message', handler);\n            };\n        }\n        return () => { };\n    }, []);\n    /**\n     * We do not have a token and user is connecting from an unsupported country,\n     * so we show the country not supported screen\n     */\n    (0, react_1.useEffect)(() => {\n        if (gatekeeperRecordState === types_1.GatekeeperAPIStatus.LOCATION_NOT_SUPPORTED ||\n            gatekeeperRecordState === types_1.GatekeeperAPIStatus.VPN_NOT_SUPPORTED) {\n            dispatch({ type: 'civicPass_check_token_status' });\n        }\n    }, [gatekeeperRecordState]);\n    /**\n     * Check for the ongoing KYC status\n     */\n    (0, react_1.useEffect)(() => {\n        if (gatekeeperRecordState === types_1.GatekeeperAPIStatus.NOT_REQUESTED) {\n            dispatch({ type: 'civicPass_check_status' });\n        }\n    }, [gatekeeperRecordState]);\n    return { dispatchComplianceEventResult };\n};\nexports.default = useCivicPass;\n"]},"metadata":{},"sourceType":"script"}