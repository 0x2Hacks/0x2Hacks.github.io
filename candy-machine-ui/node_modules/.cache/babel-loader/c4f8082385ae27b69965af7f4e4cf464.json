{"ast":null,"code":"\"use strict\";\n\nvar _regeneratorRuntime = require(\"/workspace/0x2Hacks.github.io/candy-machine-ui/node_modules/@babel/runtime/regenerator/index.js\");\n\nvar _asyncToGenerator = require(\"/workspace/0x2Hacks.github.io/candy-machine-ui/node_modules/@babel/runtime/helpers/asyncToGenerator.js\").default;\n\nvar _defineProperty = require(\"/workspace/0x2Hacks.github.io/candy-machine-ui/node_modules/@babel/runtime/helpers/defineProperty.js\").default;\n\nvar __createBinding = this && this.__createBinding || (Object.create ? function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  var desc = Object.getOwnPropertyDescriptor(m, k);\n\n  if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n    desc = {\n      enumerable: true,\n      get: function get() {\n        return m[k];\n      }\n    };\n  }\n\n  Object.defineProperty(o, k2, desc);\n} : function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\n\nvar __setModuleDefault = this && this.__setModuleDefault || (Object.create ? function (o, v) {\n  Object.defineProperty(o, \"default\", {\n    enumerable: true,\n    value: v\n  });\n} : function (o, v) {\n  o[\"default\"] = v;\n});\n\nvar __importStar = this && this.__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) {\n    if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n  }\n\n  __setModuleDefault(result, mod);\n\n  return result;\n};\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.reducer = void 0;\n\nvar react_1 = require(\"react\");\n\nvar R = __importStar(require(\"ramda\"));\n\nvar types_1 = require(\"../types\");\n\nvar logger_1 = __importDefault(require(\"../logger\"));\n\nvar useWalletHooks_1 = __importDefault(require(\"./useWalletHooks\"));\n\nvar reducer = function reducer(state, action) {\n  switch (action.type) {\n    case 'getGatekeeperRecord':\n      return Object.assign(Object.assign({}, state), {\n        gatewayStatus: types_1.GatewayStatus.CHECKING,\n        gatekeeperRecordState: undefined\n      });\n\n    case 'getGatekeeperRecord_failure':\n      return Object.assign(Object.assign({}, state), {\n        gatekeeperRecordState: action.gatekeeperRecord.state\n      });\n\n    case 'getGatekeeperRecord_success':\n      return Object.assign(Object.assign({}, state), {\n        gatekeeperRecordState: action.gatekeeperRecord.state,\n        civicPass: Object.assign(Object.assign({}, state.civicPass), {\n          requestPayload: action.gatekeeperRecord.payload\n        })\n      });\n\n    case 'getGatekeeperRecord_location_not_supported':\n    case 'getGatekeeperRecord_issued_location_not_supported':\n      return Object.assign(Object.assign({}, state), {\n        gatewayStatus: types_1.GatewayStatus.LOCATION_NOT_SUPPORTED,\n        gatekeeperRecordState: action.gatekeeperRecord.state,\n        civicPass: Object.assign(Object.assign({}, state.civicPass), {\n          requestPayload: action.gatekeeperRecord.payload\n        })\n      });\n\n    case 'getGatekeeperRecord_vpn_not_supported':\n    case 'getGatekeeperRecord_issued_vpn_not_supported':\n      return Object.assign(Object.assign({}, state), {\n        gatewayStatus: types_1.GatewayStatus.VPN_NOT_SUPPORTED,\n        gatekeeperRecordState: action.gatekeeperRecord.state,\n        civicPass: Object.assign(Object.assign({}, state.civicPass), {\n          requestPayload: action.gatekeeperRecord.payload\n        })\n      });\n\n    case 'getGatekeeperRecord_not_found':\n      return Object.assign(Object.assign({}, state), {\n        gatekeeperRecordState: action.gatekeeperRecord.state\n      });\n\n    default:\n      return state;\n  }\n};\n\nexports.reducer = reducer;\n\nvar useGetGatekeeperRecord = function useGetGatekeeperRecord(_ref, state, dispatch) {\n  var wallet = _ref.wallet,\n      gatekeeperClient = _ref.gatekeeperClient,\n      httpConfig = _ref.httpConfig,\n      networkConfig = _ref.networkConfig;\n\n  var _ref2 = (0, useWalletHooks_1.default)(wallet, state, dispatch),\n      expectWalletConnected = _ref2.expectWalletConnected;\n\n  var logDebug = function logDebug(message) {\n    var obj = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;\n    return logger_1.default.debug(\"[useGetGatekeeperRecord] \".concat(message), obj);\n  };\n\n  var gatekeeperNetworkAddress = state.gatekeeperNetworkAddress;\n\n  var dispatchFetch = function dispatchFetch() {\n    return {\n      type: 'getGatekeeperRecord'\n    };\n  };\n\n  var dispatchFailure = function dispatchFailure() {\n    return {\n      type: 'getGatekeeperRecord_failure',\n      gatekeeperRecord: {\n        state: types_1.GatekeeperAPIStatus.SERVER_FAILURE,\n        payload: undefined\n      }\n    };\n  };\n\n  var dispatchSuccess = function dispatchSuccess(record) {\n    return {\n      type: 'getGatekeeperRecord_success',\n      gatekeeperRecord: record\n    };\n  };\n\n  var dispatchLocationNotSupported = function dispatchLocationNotSupported(record) {\n    return {\n      type: 'getGatekeeperRecord_location_not_supported',\n      gatekeeperRecord: record\n    };\n  };\n\n  var dispatchIssuedLocationNotSupported = function dispatchIssuedLocationNotSupported(record) {\n    return {\n      type: 'getGatekeeperRecord_issued_location_not_supported',\n      gatekeeperRecord: record\n    };\n  };\n\n  var dispatchVpnNotSupported = function dispatchVpnNotSupported(record) {\n    return {\n      type: 'getGatekeeperRecord_vpn_not_supported',\n      gatekeeperRecord: record\n    };\n  };\n\n  var dispatchIssuedVpnNotSupported = function dispatchIssuedVpnNotSupported(record) {\n    return {\n      type: 'getGatekeeperRecord_issued_vpn_not_supported',\n      gatekeeperRecord: record\n    };\n  };\n\n  var dispatchRecordNotFound = function dispatchRecordNotFound(record) {\n    return {\n      type: 'getGatekeeperRecord_not_found',\n      gatekeeperRecord: record\n    };\n  };\n\n  var getAction = function getAction(gatekeeperRecordState) {\n    var _actions;\n\n    var actions = (_actions = {}, _defineProperty(_actions, types_1.GatekeeperAPIStatus.REQUESTED, function () {\n      return dispatchSuccess(gatekeeperRecordState);\n    }), _defineProperty(_actions, types_1.GatekeeperAPIStatus.ISSUED, function () {\n      return dispatchSuccess(gatekeeperRecordState);\n    }), _defineProperty(_actions, types_1.GatekeeperAPIStatus.ISSUED_EXPIRED, function () {\n      return dispatchSuccess(gatekeeperRecordState);\n    }), _defineProperty(_actions, types_1.GatekeeperAPIStatus.ISSUED_EXPIRY_APPROACHING, function () {\n      return dispatchSuccess(gatekeeperRecordState);\n    }), _defineProperty(_actions, types_1.GatekeeperAPIStatus.ISSUED_LOCATION_NOT_SUPPORTED, function () {\n      return dispatchIssuedLocationNotSupported(gatekeeperRecordState);\n    }), _defineProperty(_actions, types_1.GatekeeperAPIStatus.ISSUED_VPN_NOT_SUPPORTED, function () {\n      return dispatchIssuedVpnNotSupported(gatekeeperRecordState);\n    }), _defineProperty(_actions, types_1.GatekeeperAPIStatus.VPN_NOT_SUPPORTED, function () {\n      return dispatchVpnNotSupported(gatekeeperRecordState);\n    }), _defineProperty(_actions, types_1.GatekeeperAPIStatus.LOCATION_NOT_SUPPORTED, function () {\n      return dispatchLocationNotSupported(gatekeeperRecordState);\n    }), _defineProperty(_actions, types_1.GatekeeperAPIStatus.NOT_REQUESTED, function () {\n      return dispatchRecordNotFound(gatekeeperRecordState);\n    }), _actions);\n    return actions[gatekeeperRecordState.state];\n  };\n  /**\n   * Check to see if there is getGatekeeperRecord and dispatch actions based on the state of the record.\n   * If the service call fails dispatch a failure.\n   */\n\n\n  var dispatchGatekeeperRecord = /*#__PURE__*/function () {\n    var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      var walletAddress, record, action;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              walletAddress = expectWalletConnected();\n              logDebug('Fetching Gatekeeper record...', walletAddress);\n              dispatch(dispatchFetch());\n              _context.prev = 3;\n              _context.next = 6;\n              return gatekeeperClient().getGatekeeperRecordWithPayload(walletAddress.publicKey);\n\n            case 6:\n              record = _context.sent;\n              logDebug('Gatekeeper record response state: ', types_1.GatekeeperAPIStatus[record.state]);\n              action = getAction(record);\n\n              if (action) {\n                _context.next = 13;\n                break;\n              }\n\n              logger_1.default.error('Cannot dispatch action for invalid Gatekeeper Record State.', {\n                record: record\n              });\n              dispatch(dispatchFailure());\n              return _context.abrupt(\"return\");\n\n            case 13:\n              dispatch(action());\n              _context.next = 21;\n              break;\n\n            case 16:\n              _context.prev = 16;\n              _context.t0 = _context[\"catch\"](3);\n              logger_1.default.error('Failed to fetch Gatekeeper record', _context.t0);\n              dispatch(dispatchFailure());\n              throw _context.t0;\n\n            case 21:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[3, 16]]);\n    }));\n\n    return function dispatchGatekeeperRecord() {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n\n  var useHttpConfigRef = function useHttpConfigRef(newHttpConfig) {\n    var ref = (0, react_1.useRef)(); // We have to perform a deep equality check, otherwise useEffect will run every time the httpConfig object reference changes.\n\n    if (!R.equals(newHttpConfig, ref.current)) {\n      ref.current = newHttpConfig;\n    }\n\n    return ref.current;\n  };\n\n  (0, react_1.useEffect)(function () {\n    logger_1.default.debug('useEffect: useGatekeeperRecord networkConfig.requiresGatekeeperRecordStatusCheck', networkConfig.requiresGatekeeperRecordStatusCheck);\n\n    if (networkConfig.requiresGatekeeperRecordStatusCheck) {\n      // if a gateway token exists we should poll as a record should (eventually) exist\n      dispatchGatekeeperRecord();\n    }\n  }, [gatekeeperNetworkAddress, useHttpConfigRef(httpConfig), networkConfig.requiresGatekeeperRecordStatusCheck]);\n  return {\n    dispatchGatekeeperRecord: dispatchGatekeeperRecord\n  };\n};\n\nexports.default = useGetGatekeeperRecord;","map":{"version":3,"sources":["/workspace/0x2Hacks.github.io/candy-machine-ui/node_modules/@civic/common-gateway-react/dist/esm/useHooks/useGatekeeperRecord.js"],"names":["__createBinding","Object","create","o","m","k","k2","undefined","desc","getOwnPropertyDescriptor","__esModule","writable","configurable","enumerable","get","defineProperty","__setModuleDefault","v","value","__importStar","mod","result","prototype","hasOwnProperty","call","__importDefault","exports","reducer","react_1","require","R","types_1","logger_1","useWalletHooks_1","state","action","type","assign","gatewayStatus","GatewayStatus","CHECKING","gatekeeperRecordState","gatekeeperRecord","civicPass","requestPayload","payload","LOCATION_NOT_SUPPORTED","VPN_NOT_SUPPORTED","useGetGatekeeperRecord","dispatch","wallet","gatekeeperClient","httpConfig","networkConfig","default","expectWalletConnected","logDebug","message","obj","debug","gatekeeperNetworkAddress","dispatchFetch","dispatchFailure","GatekeeperAPIStatus","SERVER_FAILURE","dispatchSuccess","record","dispatchLocationNotSupported","dispatchIssuedLocationNotSupported","dispatchVpnNotSupported","dispatchIssuedVpnNotSupported","dispatchRecordNotFound","getAction","actions","REQUESTED","ISSUED","ISSUED_EXPIRED","ISSUED_EXPIRY_APPROACHING","ISSUED_LOCATION_NOT_SUPPORTED","ISSUED_VPN_NOT_SUPPORTED","NOT_REQUESTED","dispatchGatekeeperRecord","walletAddress","getGatekeeperRecordWithPayload","publicKey","error","useHttpConfigRef","newHttpConfig","ref","useRef","equals","current","useEffect","requiresGatekeeperRecordStatusCheck"],"mappings":"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","sourcesContent":["\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.reducer = void 0;\nconst react_1 = require(\"react\");\nconst R = __importStar(require(\"ramda\"));\nconst types_1 = require(\"../types\");\nconst logger_1 = __importDefault(require(\"../logger\"));\nconst useWalletHooks_1 = __importDefault(require(\"./useWalletHooks\"));\nconst reducer = (state, action) => {\n    switch (action.type) {\n        case 'getGatekeeperRecord':\n            return Object.assign(Object.assign({}, state), { gatewayStatus: types_1.GatewayStatus.CHECKING, gatekeeperRecordState: undefined });\n        case 'getGatekeeperRecord_failure':\n            return Object.assign(Object.assign({}, state), { gatekeeperRecordState: action.gatekeeperRecord.state });\n        case 'getGatekeeperRecord_success':\n            return Object.assign(Object.assign({}, state), { gatekeeperRecordState: action.gatekeeperRecord.state, civicPass: Object.assign(Object.assign({}, state.civicPass), { requestPayload: action.gatekeeperRecord.payload }) });\n        case 'getGatekeeperRecord_location_not_supported':\n        case 'getGatekeeperRecord_issued_location_not_supported':\n            return Object.assign(Object.assign({}, state), { gatewayStatus: types_1.GatewayStatus.LOCATION_NOT_SUPPORTED, gatekeeperRecordState: action.gatekeeperRecord.state, civicPass: Object.assign(Object.assign({}, state.civicPass), { requestPayload: action.gatekeeperRecord.payload }) });\n        case 'getGatekeeperRecord_vpn_not_supported':\n        case 'getGatekeeperRecord_issued_vpn_not_supported':\n            return Object.assign(Object.assign({}, state), { gatewayStatus: types_1.GatewayStatus.VPN_NOT_SUPPORTED, gatekeeperRecordState: action.gatekeeperRecord.state, civicPass: Object.assign(Object.assign({}, state.civicPass), { requestPayload: action.gatekeeperRecord.payload }) });\n        case 'getGatekeeperRecord_not_found':\n            return Object.assign(Object.assign({}, state), { gatekeeperRecordState: action.gatekeeperRecord.state });\n        default:\n            return state;\n    }\n};\nexports.reducer = reducer;\nconst useGetGatekeeperRecord = ({ wallet, gatekeeperClient, httpConfig, networkConfig, }, state, dispatch) => {\n    const { expectWalletConnected } = (0, useWalletHooks_1.default)(wallet, state, dispatch);\n    const logDebug = (message, obj = null) => logger_1.default.debug(`[useGetGatekeeperRecord] ${message}`, obj);\n    const { gatekeeperNetworkAddress } = state;\n    const dispatchFetch = () => ({\n        type: 'getGatekeeperRecord',\n    });\n    const dispatchFailure = () => ({\n        type: 'getGatekeeperRecord_failure',\n        gatekeeperRecord: { state: types_1.GatekeeperAPIStatus.SERVER_FAILURE, payload: undefined },\n    });\n    const dispatchSuccess = (record) => ({\n        type: 'getGatekeeperRecord_success',\n        gatekeeperRecord: record,\n    });\n    const dispatchLocationNotSupported = (record) => ({\n        type: 'getGatekeeperRecord_location_not_supported',\n        gatekeeperRecord: record,\n    });\n    const dispatchIssuedLocationNotSupported = (record) => ({\n        type: 'getGatekeeperRecord_issued_location_not_supported',\n        gatekeeperRecord: record,\n    });\n    const dispatchVpnNotSupported = (record) => ({\n        type: 'getGatekeeperRecord_vpn_not_supported',\n        gatekeeperRecord: record,\n    });\n    const dispatchIssuedVpnNotSupported = (record) => ({\n        type: 'getGatekeeperRecord_issued_vpn_not_supported',\n        gatekeeperRecord: record,\n    });\n    const dispatchRecordNotFound = (record) => ({\n        type: 'getGatekeeperRecord_not_found',\n        gatekeeperRecord: record,\n    });\n    const getAction = (gatekeeperRecordState) => {\n        const actions = {\n            [types_1.GatekeeperAPIStatus.REQUESTED]: () => dispatchSuccess(gatekeeperRecordState),\n            [types_1.GatekeeperAPIStatus.ISSUED]: () => dispatchSuccess(gatekeeperRecordState),\n            [types_1.GatekeeperAPIStatus.ISSUED_EXPIRED]: () => dispatchSuccess(gatekeeperRecordState),\n            [types_1.GatekeeperAPIStatus.ISSUED_EXPIRY_APPROACHING]: () => dispatchSuccess(gatekeeperRecordState),\n            [types_1.GatekeeperAPIStatus.ISSUED_LOCATION_NOT_SUPPORTED]: () => dispatchIssuedLocationNotSupported(gatekeeperRecordState),\n            [types_1.GatekeeperAPIStatus.ISSUED_VPN_NOT_SUPPORTED]: () => dispatchIssuedVpnNotSupported(gatekeeperRecordState),\n            [types_1.GatekeeperAPIStatus.VPN_NOT_SUPPORTED]: () => dispatchVpnNotSupported(gatekeeperRecordState),\n            [types_1.GatekeeperAPIStatus.LOCATION_NOT_SUPPORTED]: () => dispatchLocationNotSupported(gatekeeperRecordState),\n            [types_1.GatekeeperAPIStatus.NOT_REQUESTED]: () => dispatchRecordNotFound(gatekeeperRecordState),\n        };\n        return actions[gatekeeperRecordState.state];\n    };\n    /**\n     * Check to see if there is getGatekeeperRecord and dispatch actions based on the state of the record.\n     * If the service call fails dispatch a failure.\n     */\n    const dispatchGatekeeperRecord = async () => {\n        const walletAddress = expectWalletConnected();\n        logDebug('Fetching Gatekeeper record...', walletAddress);\n        dispatch(dispatchFetch());\n        try {\n            const record = await gatekeeperClient().getGatekeeperRecordWithPayload(walletAddress.publicKey);\n            logDebug('Gatekeeper record response state: ', types_1.GatekeeperAPIStatus[record.state]);\n            const action = getAction(record);\n            if (!action) {\n                logger_1.default.error('Cannot dispatch action for invalid Gatekeeper Record State.', { record });\n                dispatch(dispatchFailure());\n                return;\n            }\n            dispatch(action());\n        }\n        catch (error) {\n            logger_1.default.error('Failed to fetch Gatekeeper record', error);\n            dispatch(dispatchFailure());\n            throw error;\n        }\n    };\n    const useHttpConfigRef = (newHttpConfig) => {\n        const ref = (0, react_1.useRef)();\n        // We have to perform a deep equality check, otherwise useEffect will run every time the httpConfig object reference changes.\n        if (!R.equals(newHttpConfig, ref.current)) {\n            ref.current = newHttpConfig;\n        }\n        return ref.current;\n    };\n    (0, react_1.useEffect)(() => {\n        logger_1.default.debug('useEffect: useGatekeeperRecord networkConfig.requiresGatekeeperRecordStatusCheck', networkConfig.requiresGatekeeperRecordStatusCheck);\n        if (networkConfig.requiresGatekeeperRecordStatusCheck) {\n            // if a gateway token exists we should poll as a record should (eventually) exist\n            dispatchGatekeeperRecord();\n        }\n    }, [gatekeeperNetworkAddress, useHttpConfigRef(httpConfig), networkConfig.requiresGatekeeperRecordStatusCheck]);\n    return { dispatchGatekeeperRecord };\n};\nexports.default = useGetGatekeeperRecord;\n"]},"metadata":{},"sourceType":"script"}