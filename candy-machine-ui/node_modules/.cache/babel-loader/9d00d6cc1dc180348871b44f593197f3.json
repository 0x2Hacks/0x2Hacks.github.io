{"ast":null,"code":"\"use strict\";\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.reducer = exports.combineReducers = void 0;\n\nvar logger_1 = __importDefault(require(\"../logger\"));\n\nvar types_1 = require(\"../types\");\n\nvar utils_1 = require(\"./utils\");\n\nvar status_1 = require(\"../utils/status\");\n\nvar combineReducers = function combineReducers() {\n  for (var _len = arguments.length, reducers = new Array(_len), _key = 0; _key < _len; _key++) {\n    reducers[_key] = arguments[_key];\n  }\n\n  return function (state, action) {\n    return reducers.reduce(function (newState, reducer) {\n      return reducer(newState, action);\n    }, state);\n  };\n};\n\nexports.combineReducers = combineReducers;\n\nvar reducer = function reducer(state, action) {\n  var _a;\n\n  var gatewayStatus = (0, utils_1.statusFromToken)(state, state.gatewayToken) || types_1.GatewayStatus.UNKNOWN;\n  var updatedState = Object.assign(Object.assign({}, state), {\n    gatewayStatus: gatewayStatus\n  }); // eslint-disable-next-line no-prototype-builtins\n\n  var tokenCreationInProgress = !!((_a = updatedState.civicPass.responsePayload) === null || _a === void 0 ? void 0 : _a.hasOwnProperty(types_1.CivicPassMessageAction.ISSUANCE));\n  logger_1.default.debug(\"reducer.action: \".concat(action.type), (0, status_1.statusDisplayValue)(updatedState.gatewayStatus));\n\n  switch (action.type) {\n    case 'startWalletPowo':\n      {\n        return Object.assign(Object.assign({}, updatedState), {\n          walletPowoInProgress: true\n        });\n      }\n\n    case 'walletPowoComplete':\n      {\n        logger_1.default.debug('tokenCreationInProgress', {\n          tokenCreationInProgress: tokenCreationInProgress\n        });\n        return Object.assign(Object.assign({}, updatedState), {\n          // only move to IN_REVIEW if it's during the initial token creation flow\n          gatewayStatus: tokenCreationInProgress ? types_1.GatewayStatus.IN_REVIEW : updatedState.gatewayStatus,\n          walletPowoInProgress: false,\n          firstTokenCheck: false\n        });\n      }\n\n    case 'walletPowoIncomplete':\n      {\n        logger_1.default.debug('tokenCreationInProgress', {\n          tokenCreationInProgress: tokenCreationInProgress\n        });\n        return Object.assign(Object.assign({}, state), {\n          renderIframe: false,\n          iframeMinimized: true,\n          powoFinished: false,\n          refreshTokenState: types_1.RefreshTokenState.IN_PROGRESS\n        });\n      }\n\n    case 'tokenChange':\n      return Object.assign(Object.assign({}, state), {\n        gatewayStatus: (0, utils_1.statusFromToken)(state, action.token),\n        powoFinished: false,\n        gatewayToken: action.token,\n        tokenIssuanceState: types_1.TokenIssuanceState.COMPLETED\n      });\n\n    case 'powoComplete':\n      return Object.assign(Object.assign({}, updatedState), {\n        gatewayStatus: types_1.GatewayStatus.PROOF_OF_WALLET_OWNERSHIP,\n        powoFinished: true,\n        powoRequested: undefined,\n        refreshTimeoutId: undefined,\n        refreshTokenState: state.refreshTokenState === types_1.RefreshTokenState.IN_PROGRESS ? types_1.RefreshTokenState.REQUIRES_POWO : state.refreshTokenState\n      });\n\n    case 'walletDisconnected':\n      return (0, utils_1.resetState)(state);\n\n    case 'requestGatekeeperIssuance':\n      return Object.assign(Object.assign({}, updatedState), {\n        powoFinished: false,\n        walletPowoInProgress: false,\n        tokenIssuanceState: types_1.TokenIssuanceState.IN_PROGRESS\n      });\n\n    case 'requestGatekeeperIssuanceComplete':\n      return Object.assign(Object.assign({}, updatedState), {\n        tokenIssuanceState: types_1.TokenIssuanceState.COMPLETED,\n        gatewayTokenTransaction: action.gatewayTokenTransaction,\n        civicPass: Object.assign(Object.assign({}, updatedState.civicPass), {\n          responsePayload: undefined\n        })\n      });\n\n    case 'requestGatekeeperIssuanceFailed':\n      return Object.assign(Object.assign({}, (0, utils_1.resetState)(state)), {\n        gatewayStatus: types_1.GatewayStatus.ERROR,\n        tokenIssuanceState: types_1.TokenIssuanceState.FAILED\n      });\n\n    case 'refreshAttemptDone':\n      return Object.assign(Object.assign({}, updatedState), {\n        refreshInProgress: false\n      });\n\n    case 'updateStateWithProps':\n      return Object.assign(Object.assign({}, state), {\n        stage: action.stage,\n        walletAddress: action.walletAddress,\n        redirectUrl: action.redirectUrl,\n        gatekeeperNetworkAddress: action.gatekeeperNetworkAddress,\n        ownerSigns: action.ownerSigns\n      });\n\n    case 'tokenNotFoundError':\n      return Object.assign(Object.assign({}, state), {\n        renderIframe: false,\n        iframeMinimized: true,\n        gatewayStatus: types_1.GatewayStatus.ERROR\n      });\n\n    case 'gatekeeperNetworkChanged':\n      return Object.assign(Object.assign({}, (0, utils_1.resetState)(state)), {\n        gatekeeperNetworkAddress: action.gatekeeperNetworkAddress,\n        walletAddress: state.walletAddress\n      });\n\n    default:\n      return state;\n  }\n};\n\nexports.reducer = reducer;","map":{"version":3,"sources":["/workspace/0x2Hacks.github.io/candy-machine-ui/node_modules/@civic/common-gateway-react/dist/esm/useReducer/reducer.js"],"names":["__importDefault","mod","__esModule","Object","defineProperty","exports","value","reducer","combineReducers","logger_1","require","types_1","utils_1","status_1","reducers","state","action","reduce","newState","_a","gatewayStatus","statusFromToken","gatewayToken","GatewayStatus","UNKNOWN","updatedState","assign","tokenCreationInProgress","civicPass","responsePayload","hasOwnProperty","CivicPassMessageAction","ISSUANCE","default","debug","type","statusDisplayValue","walletPowoInProgress","IN_REVIEW","firstTokenCheck","renderIframe","iframeMinimized","powoFinished","refreshTokenState","RefreshTokenState","IN_PROGRESS","token","tokenIssuanceState","TokenIssuanceState","COMPLETED","PROOF_OF_WALLET_OWNERSHIP","powoRequested","undefined","refreshTimeoutId","REQUIRES_POWO","resetState","gatewayTokenTransaction","ERROR","FAILED","refreshInProgress","stage","walletAddress","redirectUrl","gatekeeperNetworkAddress","ownerSigns"],"mappings":"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","sourcesContent":["\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.reducer = exports.combineReducers = void 0;\nconst logger_1 = __importDefault(require(\"../logger\"));\nconst types_1 = require(\"../types\");\nconst utils_1 = require(\"./utils\");\nconst status_1 = require(\"../utils/status\");\nconst combineReducers = (...reducers) => (state, action) => reducers.reduce((newState, reducer) => reducer(newState, action), state);\nexports.combineReducers = combineReducers;\nconst reducer = (state, action) => {\n    var _a;\n    const gatewayStatus = (0, utils_1.statusFromToken)(state, state.gatewayToken) || types_1.GatewayStatus.UNKNOWN;\n    const updatedState = Object.assign(Object.assign({}, state), { gatewayStatus });\n    // eslint-disable-next-line no-prototype-builtins\n    const tokenCreationInProgress = !!((_a = updatedState.civicPass.responsePayload) === null || _a === void 0 ? void 0 : _a.hasOwnProperty(types_1.CivicPassMessageAction.ISSUANCE));\n    logger_1.default.debug(`reducer.action: ${action.type}`, (0, status_1.statusDisplayValue)(updatedState.gatewayStatus));\n    switch (action.type) {\n        case 'startWalletPowo': {\n            return Object.assign(Object.assign({}, updatedState), { walletPowoInProgress: true });\n        }\n        case 'walletPowoComplete': {\n            logger_1.default.debug('tokenCreationInProgress', { tokenCreationInProgress });\n            return Object.assign(Object.assign({}, updatedState), { \n                // only move to IN_REVIEW if it's during the initial token creation flow\n                gatewayStatus: tokenCreationInProgress ? types_1.GatewayStatus.IN_REVIEW : updatedState.gatewayStatus, walletPowoInProgress: false, firstTokenCheck: false });\n        }\n        case 'walletPowoIncomplete': {\n            logger_1.default.debug('tokenCreationInProgress', { tokenCreationInProgress });\n            return Object.assign(Object.assign({}, state), { renderIframe: false, iframeMinimized: true, powoFinished: false, refreshTokenState: types_1.RefreshTokenState.IN_PROGRESS });\n        }\n        case 'tokenChange':\n            return Object.assign(Object.assign({}, state), { gatewayStatus: (0, utils_1.statusFromToken)(state, action.token), powoFinished: false, gatewayToken: action.token, tokenIssuanceState: types_1.TokenIssuanceState.COMPLETED });\n        case 'powoComplete':\n            return Object.assign(Object.assign({}, updatedState), { gatewayStatus: types_1.GatewayStatus.PROOF_OF_WALLET_OWNERSHIP, powoFinished: true, powoRequested: undefined, refreshTimeoutId: undefined, refreshTokenState: state.refreshTokenState === types_1.RefreshTokenState.IN_PROGRESS\n                    ? types_1.RefreshTokenState.REQUIRES_POWO\n                    : state.refreshTokenState });\n        case 'walletDisconnected':\n            return (0, utils_1.resetState)(state);\n        case 'requestGatekeeperIssuance':\n            return Object.assign(Object.assign({}, updatedState), { powoFinished: false, walletPowoInProgress: false, tokenIssuanceState: types_1.TokenIssuanceState.IN_PROGRESS });\n        case 'requestGatekeeperIssuanceComplete':\n            return Object.assign(Object.assign({}, updatedState), { tokenIssuanceState: types_1.TokenIssuanceState.COMPLETED, gatewayTokenTransaction: action.gatewayTokenTransaction, civicPass: Object.assign(Object.assign({}, updatedState.civicPass), { responsePayload: undefined }) });\n        case 'requestGatekeeperIssuanceFailed':\n            return Object.assign(Object.assign({}, (0, utils_1.resetState)(state)), { gatewayStatus: types_1.GatewayStatus.ERROR, tokenIssuanceState: types_1.TokenIssuanceState.FAILED });\n        case 'refreshAttemptDone':\n            return Object.assign(Object.assign({}, updatedState), { refreshInProgress: false });\n        case 'updateStateWithProps':\n            return Object.assign(Object.assign({}, state), { stage: action.stage, walletAddress: action.walletAddress, redirectUrl: action.redirectUrl, gatekeeperNetworkAddress: action.gatekeeperNetworkAddress, ownerSigns: action.ownerSigns });\n        case 'tokenNotFoundError':\n            return Object.assign(Object.assign({}, state), { renderIframe: false, iframeMinimized: true, gatewayStatus: types_1.GatewayStatus.ERROR });\n        case 'gatekeeperNetworkChanged':\n            return Object.assign(Object.assign({}, (0, utils_1.resetState)(state)), { gatekeeperNetworkAddress: action.gatekeeperNetworkAddress, walletAddress: state.walletAddress });\n        default:\n            return state;\n    }\n};\nexports.reducer = reducer;\n"]},"metadata":{},"sourceType":"script"}