{"ast":null,"code":"\"use strict\";\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nconst react_1 = require(\"react\");\n\nconst logger_1 = __importDefault(require(\"../logger\"));\n\nconst useWalletHooks_1 = __importDefault(require(\"./useWalletHooks\"));\n\nconst useGatekeeper = (_ref, state, dispatch) => {\n  let {\n    wallet,\n    stage,\n    gatekeeperClient\n  } = _ref;\n  const {\n    expectWalletConnected\n  } = (0, useWalletHooks_1.default)(wallet, state, dispatch);\n  const {\n    gatekeeperNetworkAddress,\n    ownerSigns\n  } = state;\n  /**\n   * if a request is not already in progress, initiate a request to the gatekeeper for a new token\n   * and dispatch an event so we know it's in progress\n   */\n\n  const waitForGatekeeperIssuanceRequest = (0, react_1.useCallback)( // eslint-disable-next-line @typescript-eslint/no-shadow\n  async _ref2 => {\n    let {\n      payload,\n      proof\n    } = _ref2;\n    const connectedWallet = expectWalletConnected();\n    logger_1.default.debug('waitForGatekeeperIssuanceRequest ready to call requestGatewayTokenFromGatekeeper', {\n      payload\n    });\n    dispatch({\n      type: 'requestGatekeeperIssuance'\n    });\n    const requestGatewayTokenFromGatekeeperResult = await gatekeeperClient().requestGatewayTokenFromGatekeeper({\n      wallet: connectedWallet,\n      payload,\n      proof,\n      ownerSigns: ownerSigns !== null && ownerSigns !== void 0 ? ownerSigns : false\n    });\n    logger_1.default.debug('requestGatewayTokenFromGatekeeperResult', requestGatewayTokenFromGatekeeperResult);\n\n    if (requestGatewayTokenFromGatekeeperResult.status >= 400) {\n      logger_1.default.error('Error requesting token from gatekeeper');\n      dispatch({\n        type: 'requestGatekeeperIssuanceFailed'\n      });\n      throw new Error('Error requesting token from gatekeeper');\n    }\n\n    const {\n      transaction\n    } = requestGatewayTokenFromGatekeeperResult;\n    logger_1.default.debug('Successfully requested gatekeeper token');\n    dispatch({\n      type: 'requestGatekeeperIssuanceComplete',\n      gatewayTokenTransaction: transaction\n    });\n    return transaction;\n  }, [gatekeeperClient, expectWalletConnected, stage, ownerSigns]);\n  /**\n   * Update the state when the Gatekeeper network changes\n   */\n\n  (0, react_1.useEffect)(() => {\n    if (wallet && wallet.publicKey && gatekeeperNetworkAddress) {\n      dispatch({\n        type: 'gatekeeperNetworkChanged',\n        gatekeeperNetworkAddress\n      });\n    }\n  }, [gatekeeperNetworkAddress]);\n  return {\n    waitForGatekeeperIssuanceRequest,\n    gatekeeperClient\n  };\n};\n\nexports.default = useGatekeeper;","map":{"version":3,"sources":["/workspace/0x2Hacks.github.io/candy-machine-ui/node_modules/@civic/common-gateway-react/dist/esm/useHooks/useGatekeeper.js"],"names":["__importDefault","mod","__esModule","Object","defineProperty","exports","value","react_1","require","logger_1","useWalletHooks_1","useGatekeeper","state","dispatch","wallet","stage","gatekeeperClient","expectWalletConnected","default","gatekeeperNetworkAddress","ownerSigns","waitForGatekeeperIssuanceRequest","useCallback","payload","proof","connectedWallet","debug","type","requestGatewayTokenFromGatekeeperResult","requestGatewayTokenFromGatekeeper","status","error","Error","transaction","gatewayTokenTransaction","useEffect","publicKey"],"mappings":"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","sourcesContent":["\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst react_1 = require(\"react\");\nconst logger_1 = __importDefault(require(\"../logger\"));\nconst useWalletHooks_1 = __importDefault(require(\"./useWalletHooks\"));\nconst useGatekeeper = ({ wallet, stage, gatekeeperClient, }, state, dispatch) => {\n    const { expectWalletConnected } = (0, useWalletHooks_1.default)(wallet, state, dispatch);\n    const { gatekeeperNetworkAddress, ownerSigns } = state;\n    /**\n     * if a request is not already in progress, initiate a request to the gatekeeper for a new token\n     * and dispatch an event so we know it's in progress\n     */\n    const waitForGatekeeperIssuanceRequest = (0, react_1.useCallback)(\n    // eslint-disable-next-line @typescript-eslint/no-shadow\n    async ({ payload, proof }) => {\n        const connectedWallet = expectWalletConnected();\n        logger_1.default.debug('waitForGatekeeperIssuanceRequest ready to call requestGatewayTokenFromGatekeeper', {\n            payload,\n        });\n        dispatch({ type: 'requestGatekeeperIssuance' });\n        const requestGatewayTokenFromGatekeeperResult = await gatekeeperClient().requestGatewayTokenFromGatekeeper({\n            wallet: connectedWallet,\n            payload,\n            proof,\n            ownerSigns: ownerSigns !== null && ownerSigns !== void 0 ? ownerSigns : false,\n        });\n        logger_1.default.debug('requestGatewayTokenFromGatekeeperResult', requestGatewayTokenFromGatekeeperResult);\n        if (requestGatewayTokenFromGatekeeperResult.status >= 400) {\n            logger_1.default.error('Error requesting token from gatekeeper');\n            dispatch({ type: 'requestGatekeeperIssuanceFailed' });\n            throw new Error('Error requesting token from gatekeeper');\n        }\n        const { transaction } = requestGatewayTokenFromGatekeeperResult;\n        logger_1.default.debug('Successfully requested gatekeeper token');\n        dispatch({ type: 'requestGatekeeperIssuanceComplete', gatewayTokenTransaction: transaction });\n        return transaction;\n    }, [gatekeeperClient, expectWalletConnected, stage, ownerSigns]);\n    /**\n     * Update the state when the Gatekeeper network changes\n     */\n    (0, react_1.useEffect)(() => {\n        if (wallet && wallet.publicKey && gatekeeperNetworkAddress) {\n            dispatch({ type: 'gatekeeperNetworkChanged', gatekeeperNetworkAddress });\n        }\n    }, [gatekeeperNetworkAddress]);\n    return {\n        waitForGatekeeperIssuanceRequest,\n        gatekeeperClient,\n    };\n};\nexports.default = useGatekeeper;\n"]},"metadata":{},"sourceType":"script"}